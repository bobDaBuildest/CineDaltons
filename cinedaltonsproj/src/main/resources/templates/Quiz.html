
<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Quiz - CineDaltons</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1a1a1a;
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            color: #fdd835;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
            color: #ccc;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 4px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background-color: #fdd835;
            color: #1a1a1a;
        }

        .btn-primary:hover {
            background-color: #ffeb3b;
            transform: scale(1.05);
        }

        .btn-secondary {
            background-color: #333;
            color: white;
            border: 2px solid #fdd835;
        }

        .btn-secondary:hover {
            background-color: #444;
            border-color: #ffeb3b;
        }

        .quiz-card {
            background-color: #2a2a2a;
            border-radius: 8px;
            padding: 40px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            border: 1px solid #444;
        }

        .quiz-start {
            text-align: center;
        }

        .quiz-start h2 {
            color: #fdd835;
            margin-bottom: 20px;
            font-size: 2em;
        }

        .quiz-start p {
            color: #ccc;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }

        .quiz-option {
            padding: 15px;
            background-color: #333;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .quiz-option:hover {
            background-color: #444;
            border-color: #fdd835;
        }

        .quiz-option.selected {
            background-color: #fdd835;
            color: #1a1a1a;
            border-color: #fdd835;
        }

        .question-container {
            display: none;
        }

        .question-container.active {
            display: block;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #444;
        }

        .question-number {
            font-size: 1.2em;
            color: #fdd835;
            font-weight: bold;
        }

        .timer {
            font-size: 1.2em;
            color: #ff6b6b;
            font-weight: bold;
        }

        .question-text {
            font-size: 1.5em;
            color: white;
            margin-bottom: 30px;
            line-height: 1.4;
        }

        .answer-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }

        .answer-option {
            padding: 20px;
            background-color: #333;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1em;
            color: white;
        }

        .answer-option:hover {
            border-color: #fdd835;
            background-color: #444;
        }

        .answer-option.selected {
            background-color: #fdd835;
            color: #1a1a1a;
            border-color: #fdd835;
        }

        .answer-option.correct {
            background-color: #51cf66;
            color: white;
            border-color: #51cf66;
        }

        .answer-option.incorrect {
            background-color: #ff6b6b;
            color: white;
            border-color: #ff6b6b;
        }

        .answer-option.disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        .quiz-actions {
            display: flex;
            justify-content: space-between;
            gap: 15px;
        }

        .btn-submit {
            flex: 1;
            background-color: #fdd835;
            color: #1a1a1a;
        }

        .btn-submit:hover {
            background-color: #ffeb3b;
        }

        .btn-submit:disabled {
            background-color: #666;
            cursor: not-allowed;
            color: #999;
        }

        .btn-next {
            flex: 1;
            background-color: #51cf66;
            color: white;
        }

        .btn-next:hover {
            background-color: #5dd879;
        }

        .results-container {
            display: none;
            text-align: center;
        }

        .results-container.active {
            display: block;
        }

        .score-display {
            font-size: 4em;
            color: #fdd835;
            font-weight: bold;
            margin: 30px 0;
            text-shadow: 0 0 20px rgba(253, 216, 53, 0.5);
        }

        .results-message {
            font-size: 1.5em;
            color: white;
            margin-bottom: 20px;
        }

        .results-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background-color: #333;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #444;
        }

        .stat-number {
            font-size: 2em;
            color: #fdd835;
            font-weight: bold;
        }

        .stat-label {
            color: #999;
            margin-top: 5px;
        }

        .leaderboard {
            margin-top: 40px;
            text-align: left;
        }

        .leaderboard h3 {
            color: #fdd835;
            margin-bottom: 20px;
            text-align: center;
        }

        .leaderboard-list {
            list-style: none;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            background-color: #333;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid #444;
            transition: all 0.3s ease;
        }

        .leaderboard-item:hover {
            background-color: #444;
            border-color: #fdd835;
        }

        .leaderboard-rank {
            font-weight: bold;
            color: #fdd835;
            width: 40px;
        }

        .leaderboard-name {
            flex: 1;
            color: white;
        }

        .leaderboard-score {
            font-weight: bold;
            color: #51cf66;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #fdd835;
            font-size: 1.2em;
        }

        .error {
            background-color: #ff6b6b;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: #333;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
            border: 1px solid #444;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #fdd835 0%, #ffeb3b 100%);
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }

            .quiz-card {
                padding: 20px;
            }

            .results-stats {
                grid-template-columns: 1fr;
            }

            .quiz-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>ğŸ¬ Movie Quiz</h1>
        <p>Î”Î¿ÎºÎ¯Î¼Î±ÏƒÎµ Ï„Î¹Ï‚ Î³Î½ÏÏƒÎµÎ¹Ï‚ ÏƒÎ¿Ï… ÏƒÏ„Î¿Î½ ÎºÏŒÏƒÎ¼Î¿ Ï„Î¿Ï… ÎºÎ¹Î½Î·Î¼Î±Ï„Î¿Î³ÏÎ¬Ï†Î¿Ï…!</p>
    </div>

    <div class="nav-buttons">
        <a href="/" class="btn btn-secondary">â† Î‘ÏÏ‡Î¹ÎºÎ®</a>
        <button id="viewLeaderboardBtn" class="btn btn-secondary">ğŸ† Leaderboard</button>
    </div>

    <div class="quiz-card">
        <!-- Start Screen -->
        <div id="startScreen" class="quiz-start">
            <h2>ÎšÎ±Î»ÏÏ‚ Î®ÏÎ¸ÎµÏ‚ ÏƒÏ„Î¿ Quiz!</h2>
            <p>Î‘Ï€Î¬Î½Ï„Î·ÏƒÎµ ÏƒÏ‰ÏƒÏ„Î¬ ÏƒÎµ ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚ Î³Î¹Î± Î´Î¹Î¬ÏƒÎ·Î¼ÎµÏ‚ Ï„Î±Î¹Î½Î¯ÎµÏ‚ ÎºÎ±Î¹ ÎºÎ­ÏÎ´Î¹ÏƒÎµ Ï€ÏŒÎ½Ï„Î¿Ï…Ï‚! <br>
                ÎšÎ¬Î¸Îµ ÏƒÏ‰ÏƒÏ„Î® Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· Ï†Î­ÏÎ½ÎµÎ¹ Ï€ÏŒÎ½Ï„Î¿Ï…Ï‚ ÏƒÏ„Î¿ ÏƒÏ…Î½Î¿Î»Î¹ÎºÏŒ ÏƒÎ¿Ï… ÏƒÎºÎ¿Ï.</p>

            <div class="quiz-options">
                <div class="quiz-option" data-questions="5">
                    <strong>ğŸ¯ Î“ÏÎ®Î³Î¿ÏÎ¿ Quiz</strong>
                    <p>5 Î•ÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚ - ~2 Î»ÎµÏ€Ï„Î¬</p>
                </div>
                <div class="quiz-option selected" data-questions="10">
                    <strong>âš¡ ÎšÎ»Î±ÏƒÎ¹ÎºÏŒ Quiz</strong>
                    <p>10 Î•ÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚ - ~5 Î»ÎµÏ€Ï„Î¬</p>
                </div>
                <div class="quiz-option" data-questions="15">
                    <strong>ğŸ”¥ Î ÏÏŒÎºÎ»Î·ÏƒÎ·</strong>
                    <p>15 Î•ÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚ - ~8 Î»ÎµÏ€Ï„Î¬</p>
                </div>
            </div>

            <button id="startQuizBtn" class="btn btn-primary">ÎÎµÎºÎ¯Î½Î± Ï„Î¿ Quiz</button>
            <p id="authError" class="error" style="display: none; margin-top: 20px;">
                Î ÏÎ­Ï€ÎµÎ¹ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯Ï‚ Î³Î¹Î± Î½Î± Ï€Î±Î¯Î¾ÎµÎ¹Ï‚ Ï„Î¿ Quiz!
            </p>
        </div>

        <!-- Question Screen -->
        <div id="questionScreen" class="question-container">
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill" style="width: 0%"></div>
            </div>

            <div class="question-header">
                <span id="questionNumber" class="question-number">Î•ÏÏÏ„Î·ÏƒÎ· 1/10</span>
                <span id="timer" class="timer">â±ï¸ 00:00</span>
            </div>

            <div id="questionText" class="question-text">
                Loading question...
            </div>

            <div id="answerOptions" class="answer-options">
                <!-- Options will be inserted here -->
            </div>

            <div class="quiz-actions">
                <button id="submitAnswerBtn" class="btn btn-submit" disabled>Î¥Ï€Î¿Î²Î¿Î»Î® Î‘Ï€Î¬Î½Ï„Î·ÏƒÎ·Ï‚</button>
                <button id="nextQuestionBtn" class="btn btn-next" style="display: none;">Î•Ï€ÏŒÎ¼ÎµÎ½Î· Î•ÏÏÏ„Î·ÏƒÎ· â†’</button>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="resultsScreen" class="results-container">
            <h2>ğŸ‰ ÎŸÎ»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎµÏ‚ Ï„Î¿ Quiz!</h2>
            <div class="score-display" id="finalScore">0/100</div>
            <div class="results-message" id="resultsMessage">Î£Ï…Î³Ï‡Î±ÏÎ·Ï„Î®ÏÎ¹Î±!</div>

            <div class="results-stats">
                <div class="stat-card">
                    <div class="stat-number" id="correctAnswers">0</div>
                    <div class="stat-label">Î£Ï‰ÏƒÏ„Î­Ï‚ Î‘Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalQuestions">0</div>
                    <div class="stat-label">Î£ÏÎ½Î¿Î»Î¿ Î•ÏÏ‰Ï„Î®ÏƒÎµÏ‰Î½</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="timeTaken">0s</div>
                    <div class="stat-label">Î§ÏÏŒÎ½Î¿Ï‚</div>
                </div>
            </div>

            <div class="quiz-actions">
                <button id="playAgainBtn" class="btn btn-primary">Î Î±Î¯Î¾Îµ ÎÎ±Î½Î¬</button>
                <button id="viewHistoryBtn" class="btn btn-secondary">Î¤Î¿ Î™ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ Î¼Î¿Ï…</button>
            </div>

            <div id="leaderboardSection" class="leaderboard" style="display: none;">
                <h3>ğŸ† Top 10 Î Î±Î¯ÎºÏ„ÎµÏ‚</h3>
                <ul id="leaderboardList" class="leaderboard-list">
                    <!-- Leaderboard items will be inserted here -->
                </ul>
            </div>
        </div>

        <!-- Loading -->
        <div id="loadingScreen" class="loading" style="display: none;">
            <p>â³ Î¦ÏŒÏÏ„Ï‰ÏƒÎ·...</p>
        </div>
    </div>
</div>

<script>
    // Quiz State Management
    let quizState = {
        sessionId: null,
        questions: [],
        currentQuestionIndex: 0,
        selectedAnswers: [],
        correctAnswers: 0,
        startTime: null,
        numberOfQuestions: 10
    };

    // DOM Elements
    const startScreen = document.getElementById('startScreen');
    const questionScreen = document.getElementById('questionScreen');
    const resultsScreen = document.getElementById('resultsScreen');
    const loadingScreen = document.getElementById('loadingScreen');

    const startQuizBtn = document.getElementById('startQuizBtn');
    const submitAnswerBtn = document.getElementById('submitAnswerBtn');
    const nextQuestionBtn = document.getElementById('nextQuestionBtn');
    const playAgainBtn = document.getElementById('playAgainBtn');
    const viewLeaderboardBtn = document.getElementById('viewLeaderboardBtn');
    const viewHistoryBtn = document.getElementById('viewHistoryBtn');

    const questionText = document.getElementById('questionText');
    const answerOptions = document.getElementById('answerOptions');
    const questionNumber = document.getElementById('questionNumber');
    const timer = document.getElementById('timer');
    const progressFill = document.getElementById('progressFill');
    const authError = document.getElementById('authError');

    // Quiz Option Selection
    document.querySelectorAll('.quiz-option').forEach(option => {
        option.addEventListener('click', function() {
            document.querySelectorAll('.quiz-option').forEach(o => o.classList.remove('selected'));
            this.classList.add('selected');
            quizState.numberOfQuestions = parseInt(this.dataset.questions);
        });
    });

    // Start Quiz
    startQuizBtn.addEventListener('click', async () => {
        authError.style.display = 'none';

        try {
            showLoading();
            const response = await fetch(`/api/quiz/start?numberOfQuestions=${quizState.numberOfQuestions}`, {
                method: 'POST',
                credentials: 'include',
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            if (!response.ok) {
                if (response.status === 401 || response.status === 403) {
                    hideLoading();
                    authError.textContent = 'Î ÏÎ­Ï€ÎµÎ¹ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯Ï‚ Î³Î¹Î± Î½Î± Ï€Î±Î¯Î¾ÎµÎ¹Ï‚ Ï„Î¿ Quiz!';
                    authError.style.display = 'block';
                    return;
                }
                throw new Error('Failed to start quiz: ' + response.statusText);
            }

            const data = await response.json();
            console.log('Quiz started:', data);

            quizState.sessionId = data.sessionId;
            quizState.questions = data.questions;
            quizState.currentQuestionIndex = 0;
            quizState.correctAnswers = 0;
            quizState.selectedAnswers = new Array(data.questions.length).fill(null);
            quizState.startTime = Date.now();

            hideLoading();
            showQuestion();
            startTimer();
        } catch (error) {
            console.error('Error starting quiz:', error);
            hideLoading();
            authError.textContent = 'Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ ÎµÎºÎºÎ¯Î½Î·ÏƒÎ· Ï„Î¿Ï… quiz: ' + error.message;
            authError.style.display = 'block';
        }
    });

    // Show Question
    function showQuestion() {
        const question = quizState.questions[quizState.currentQuestionIndex];

        startScreen.classList.remove('active');
        startScreen.style.display = 'none';
        questionScreen.classList.add('active');
        questionScreen.style.display = 'block';
        resultsScreen.style.display = 'none';

        // Update question number and progress
        questionNumber.textContent = `Î•ÏÏÏ„Î·ÏƒÎ· ${quizState.currentQuestionIndex + 1}/${quizState.questions.length}`;
        const progress = ((quizState.currentQuestionIndex + 1) / quizState.questions.length) * 100;
        progressFill.style.width = `${progress}%`;

        // Update question text
        questionText.textContent = question.question;

        // Clear and populate answer options
        answerOptions.innerHTML = '';
        question.options.forEach((option, index) => {
            const optionDiv = document.createElement('div');
            optionDiv.className = 'answer-option';
            optionDiv.textContent = option;
            optionDiv.dataset.index = index;

            // Check if already answered
            if (quizState.selectedAnswers[quizState.currentQuestionIndex] !== null) {
                optionDiv.classList.add('disabled');
            } else {
                optionDiv.addEventListener('click', selectAnswer);
            }

            answerOptions.appendChild(optionDiv);
        });

        // Reset buttons
        submitAnswerBtn.disabled = true;
        submitAnswerBtn.style.display = 'block';
        nextQuestionBtn.style.display = 'none';
    }

    // Select Answer
    function selectAnswer(e) {
        // Remove previous selection
        document.querySelectorAll('.answer-option').forEach(opt => {
            opt.classList.remove('selected');
        });

        // Add selection
        e.target.classList.add('selected');
        submitAnswerBtn.disabled = false;
    }

    // Submit Answer
    submitAnswerBtn.addEventListener('click', async () => {
        const selectedOption = document.querySelector('.answer-option.selected');
        if (!selectedOption) return;

        const selectedIndex = parseInt(selectedOption.dataset.index);

        try {
            const response = await fetch('/api/quiz/answer', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                credentials: 'include',
                body: JSON.stringify({
                    sessionId: quizState.sessionId,
                    questionIndex: quizState.currentQuestionIndex,
                    selectedAnswer: selectedIndex
                })
            });

            const isCorrect = await response.json();

            // Store answer
            quizState.selectedAnswers[quizState.currentQuestionIndex] = selectedIndex;
            if (isCorrect) {
                quizState.correctAnswers++;
            }

            // Show feedback
            document.querySelectorAll('.answer-option').forEach(opt => {
                opt.classList.add('disabled');
                opt.removeEventListener('click', selectAnswer);
            });

            if (isCorrect) {
                selectedOption.classList.remove('selected');
                selectedOption.classList.add('correct');
            } else {
                selectedOption.classList.remove('selected');
                selectedOption.classList.add('incorrect');
            }

            // Show next button
            submitAnswerBtn.style.display = 'none';
            nextQuestionBtn.style.display = 'block';

        } catch (error) {
            console.error('Error submitting answer:', error);
            alert('Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ Ï…Ï€Î¿Î²Î¿Î»Î® Ï„Î·Ï‚ Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·Ï‚');
        }
    });

    // Next Question
    nextQuestionBtn.addEventListener('click', () => {
        quizState.currentQuestionIndex++;

        if (quizState.currentQuestionIndex < quizState.questions.length) {
            showQuestion();
        } else {
            completeQuiz();
        }
    });

    // Complete Quiz
    async function completeQuiz() {
        try {
            showLoading();

            const response = await fetch(`/api/quiz/complete/${quizState.sessionId}`, {
                method: 'POST',
                credentials: 'include'
            });

            const result = await response.json();

            hideLoading();
            showResults(result);
            loadLeaderboard();

        } catch (error) {
            console.error('Error completing quiz:', error);
            hideLoading();
            alert('Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ Î¿Î»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎ· Ï„Î¿Ï… quiz');
        }
    }

    // Show Results
    function showResults(result) {
        questionScreen.style.display = 'none';
        resultsScreen.classList.add('active');
        resultsScreen.style.display = 'block';

        document.getElementById('finalScore').textContent = `${result.score}/100`;
        document.getElementById('correctAnswers').textContent = quizState.correctAnswers;
        document.getElementById('totalQuestions').textContent = quizState.questions.length;

        const timeInSeconds = Math.floor((Date.now() - quizState.startTime) / 1000);
        document.getElementById('timeTaken').textContent = `${timeInSeconds}s`;

        // Results message based on score
        let message = '';
        if (result.score >= 90) {
            message = 'ğŸŒŸ Î•ÎºÏ€Î»Î·ÎºÏ„Î¹ÎºÏŒ! Î•Î¯ÏƒÎ±Î¹ ÎµÎ¹Î´Î¹ÎºÏŒÏ‚ Ï„Î¿Ï… ÎºÎ¹Î½Î·Î¼Î±Ï„Î¿Î³ÏÎ¬Ï†Î¿Ï…!';
        } else if (result.score >= 70) {
            message = 'ğŸ¬ Î Î¿Î»Ï ÎºÎ±Î»Î¬! Î“Î½Ï‰ÏÎ¯Î¶ÎµÎ¹Ï‚ Ï„Î¹Ï‚ Ï„Î±Î¹Î½Î¯ÎµÏ‚ ÏƒÎ¿Ï…!';
        } else if (result.score >= 50) {
            message = 'ğŸ¥ ÎŒÏ‡Î¹ Î¬ÏƒÏ‡Î·Î¼Î±! Î£Ï…Î½Î­Ï‡Î¹ÏƒÎµ Î½Î± Î²Î»Î­Ï€ÎµÎ¹Ï‚ Ï„Î±Î¹Î½Î¯ÎµÏ‚!';
        } else {
            message = 'ğŸ¿ Î§ÏÎµÎ¹Î¬Î¶ÎµÏƒÎ±Î¹ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï„Î±Î¹Î½Î¯ÎµÏ‚! Î”Î¿ÎºÎ¯Î¼Î±ÏƒÎµ Î¾Î±Î½Î¬!';
        }
        document.getElementById('resultsMessage').textContent = message;
    }

    // Load Leaderboard
    async function loadLeaderboard() {
        try {
            const response = await fetch('/api/quiz/leaderboard', {
                credentials: 'include'
            });

            const leaderboard = await response.json();

            const leaderboardList = document.getElementById('leaderboardList');
            leaderboardList.innerHTML = '';

            leaderboard.forEach((entry, index) => {
                const li = document.createElement('li');
                li.className = 'leaderboard-item';
                li.innerHTML = `
                        <span class="leaderboard-rank">#${index + 1}</span>
                        <span class="leaderboard-name">${entry.user.username}</span>
                        <span class="leaderboard-score">${entry.scoreAchieved} Ï€ÏŒÎ½Ï„Î¿Î¹</span>
                    `;
                leaderboardList.appendChild(li);
            });

            document.getElementById('leaderboardSection').style.display = 'block';

        } catch (error) {
            console.error('Error loading leaderboard:', error);
        }
    }

    // View Leaderboard Button
    viewLeaderboardBtn.addEventListener('click', async () => {
        showLoading();
        await loadLeaderboard();
        hideLoading();

        startScreen.style.display = 'none';
        questionScreen.style.display = 'none';
        resultsScreen.classList.add('active');
        resultsScreen.style.display = 'block';

        // Hide stats, show only leaderboard
        document.querySelector('.results-stats').style.display = 'none';
        document.querySelector('.score-display').style.display = 'none';
        document.querySelector('.results-message').style.display = 'none';
        resultsScreen.querySelector('h2').textContent = 'ğŸ† Leaderboard';
    });

    // Play Again
    playAgainBtn.addEventListener('click', () => {
        startScreen.style.display = 'block';
        questionScreen.style.display = 'none';
        resultsScreen.style.display = 'none';

        // Reset display
        document.querySelector('.results-stats').style.display = 'grid';
        document.querySelector('.score-display').style.display = 'block';
        document.querySelector('.results-message').style.display = 'block';
        document.getElementById('leaderboardSection').style.display = 'none';

        stopTimer();
    });

    // View History
    viewHistoryBtn.addEventListener('click', async () => {
        try {
            const response = await fetch('/api/quiz/history', {
                credentials: 'include'
            });

            if (!response.ok) {
                alert('Î ÏÎ­Ï€ÎµÎ¹ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯Ï‚ Î³Î¹Î± Î½Î± Î´ÎµÎ¹Ï‚ Ï„Î¿ Î¹ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ ÏƒÎ¿Ï…');
                return;
            }

            const history = await response.json();
            console.log('Quiz History:', history);
            alert(`ÎˆÏ‡ÎµÎ¹Ï‚ Ï€Î±Î¯Î¾ÎµÎ¹ ${history.length} Ï†Î¿ÏÎ­Ï‚! Î”ÎµÏ‚ Ï„Î·Î½ ÎºÎ¿Î½ÏƒÏŒÎ»Î± Î³Î¹Î± Î»ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚.`);

        } catch (error) {
            console.error('Error loading history:', error);
        }
    });

    // Timer
    let timerInterval;
    function startTimer() {
        timerInterval = setInterval(() => {
            const elapsed = Math.floor((Date.now() - quizState.startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            timer.textContent = `â±ï¸ ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }, 1000);
    }

    function stopTimer() {
        if (timerInterval) {
            clearInterval(timerInterval);
        }
    }

    // Loading Helpers
    function showLoading() {
        loadingScreen.style.display = 'block';
        startScreen.style.display = 'none';
        questionScreen.style.display = 'none';
        resultsScreen.style.display = 'none';
    }

    function hideLoading() {
        loadingScreen.style.display = 'none';
    }

    // Cleanup on page unload
    window.addEventListener('beforeunload', stopTimer);
</script>
</body>
</html>